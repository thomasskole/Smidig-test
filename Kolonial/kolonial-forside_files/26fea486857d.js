var ModalController=(function(){function ModalController(opts){this.options={'containerEl':null};if(typeof opts!=='undefined'&&opts!==null){this.options=$.extend(this.options,opts);}
this.configure=__bind(this.configure,this);this.updateState=__bind(this.updateState,this);this.openModal=__bind(this.openModal,this);this.modalBack=__bind(this.modalBack,this);this.closeModal=__bind(this.closeModal,this);this.modalContainer=$('#modal-container');this.modalContent=this.modalContainer.find('.modal-content');this.modalVisible=false;this.historyEnabled=true;this.hasHistoryAPI=(typeof history.pushState!=='undefined');this.configure();}
ModalController.prototype.configure=function(){var _this=this;$(document).on('click','a.modal-link',this.updateState);$(document).on('click','.modal-body .back',this.modalBack);this.modalContainer.on('shown.bs.modal',function(){$(document).off('focusin.modal');});this.modalContainer.on('hide.bs.modal',function(e){_this.modalContainer.removeData('bs.modal');_this.modalContainer.find('.modal-content').html('');if(_this.modalVisible&&_this.hasHistoryAPI&&_this.historyEnabled){history.back();}
_this.modalVisible=false;_this.historyEnabled=true;});$(window).on('popstate',this.updateState);};ModalController.prototype.updateState=function(arg){var url;if(arg.type==='popstate'){if(arg.originalEvent.state===null){if(this.modalVisible){this.closeModal();}}
else{}}
else{if(arg.ctrlKey||arg.metaKey){return;}
this.historyEnabled=!($(arg.currentTarget).hasClass('modal-no-history'));url=$(arg.currentTarget).prop('href');this.openModal(arg,this.historyEnabled);arg.preventDefault();}};ModalController.prototype.openModal=function(arg,updateHistory){var url,slideIn=false;var _this=this;if(arg.hasOwnProperty('url')){url=arg.url;}
else{var target=$(arg.currentTarget);if(target.attr('data-url')){url=target.data('url');}else{url=target.prop('href');}
if(arg.currentTarget.hasAttribute('data-slide-in')){slideIn=true;}
arg.preventDefault();}
if(updateHistory&&this.hasHistoryAPI){if(!this.modalVisible){history.pushState({'url':url},'',url);}}
if(url.indexOf('?')>-1){url+='&modal';}else{url+='?modal';}
if(this.modalVisible&&slideIn){$.get(url,function(data){_this.slideIn(data);});}
else{this.modalContainer.find('.modal-content').load(url,function(){_this.modalContainer.modal('show');});}
this.modalVisible=true;};ModalController.prototype.slideIn=function(data){var modalContent=this.modalContent;modalContent.css('overflow','hidden');var modalBody=modalContent.find('.modal-body');modalBody.addClass('slide-out-left');modalContent.append(data);var lastModalBody=modalContent.find('.modal-body').last();lastModalBody.addClass('modal-child slide-in-right');setTimeout(function(){lastModalBody.removeClass('slide-in-right');},50);};ModalController.prototype.modalBack=function(){var _this=this;var previousBody=this.modalContent.find('.modal-body.slide-out-left').last();var modalBody=this.modalContent.find('.modal-body').last();previousBody.insertAfter(modalBody);previousBody.removeClass('slide-out-left');previousBody.addClass('slide-in-left');setTimeout(function(){previousBody.removeClass('slide-in-left');},50);modalBody.addClass('slide-out-right');setTimeout(function(){modalBody.remove();if(_this.modalContent.find('.modal-body').length===1){_this.modalContent.css('overflow','visible');}},600);};ModalController.prototype.closeModal=function(){this.modalVisible=false;this.modalContainer.modal('hide');};return ModalController;})();var HorizontalScrollController=(function(){function HorizontalScrollController(){this.scrollTimeout=null;this.configure=__bind(this.configure,this);this.setAnchoredSide=__bind(this.setAnchoredSide,this);this.scrolled=__bind(this.scrolled,this);this.configure();}
HorizontalScrollController.prototype.configure=function(){window.addEventListener('scroll',this.scrolled,true);};HorizontalScrollController.prototype.scrolled=function(e){var _this=this;clearTimeout(this.scrollTimeout);this.scrollTimeout=setTimeout(function(){_this.setAnchoredSide(e);},10);};HorizontalScrollController.prototype.setAnchoredSide=function(e){$scrollTarget=$(e.target);if(!$(e.target).is('.horizontal-scroll-container')){return;}
var snapAt=10;var $scrollContainer=$scrollTarget;var $scrollBarContainer=$scrollContainer.parents('.horizontal-scrollbar-container');var containerWidth=$scrollContainer.width();var totalWidth=0;$scrollContainer.find('.horizontal-scroll-item').each(function(){totalWidth+=$(this).outerWidth();});var $lastItem=$scrollContainer.find('.horizontal-scroll-item:last');var lastItemScrollPosition=$lastItem.position().left+$lastItem.outerWidth();$scrollBarContainer.removeClass('anchored-left anchored-right');if(lastItemScrollPosition+snapAt>=totalWidth){$scrollBarContainer.addClass('anchored-left');}
else if(lastItemScrollPosition-snapAt<=containerWidth){$scrollBarContainer.addClass('anchored-right');}};return HorizontalScrollController;})();var CartController=(function(){function CartController(opts){this.options={el:undefined,cartToggleUrl:undefined,narrowWindowWidth:1200,checkoutProductsUrl:undefined,};if(typeof opts!=="undefined"&&opts!==null){this.options=$.extend(this.options,opts);}
this.configure=__bind(this.configure,this);this.showCart=__bind(this.showCart,this);this.hideCart=__bind(this.hideCart,this);this.toggleCart=__bind(this.toggleCart,this);this.updateCartVisibility=__bind(this.updateCartVisibility,this);this.refreshHeader=__bind(this.refreshHeader,this);this.updateAddToCartGroups=__bind(this.updateAddToCartGroups,this);this.resetAddToCartGroups=__bind(this.resetAddToCartGroups,this);this.updateCheckoutProduct=__bind(this.updateCheckoutProduct,this);this.configure();this.updateCartVisibility();}
CartController.prototype.configure=function(){var _this=this;$('.toggle-cart').on('click',this.toggleCart);$(window).resize(this.updateCartVisibility);$(document).on('productList:willUpdate',this.updateAddToCartGroups);$(document).on('productList:didUpdate',this.resetAddToCartGroups);$(document).on('productList:didUpdate',this.updateCheckoutProduct);};CartController.prototype.showCart=function(animated){if(typeof animated==='undefined')
animated=true;if($(window).width()<this.options.narrowWindowWidth){return;}
if(!$('body').hasClass('cart-open')){this.toggleCart(undefined,animated);}};CartController.prototype.hideCart=function(animated){if(typeof animated==='undefined'){animated=true;}
if(!$('body').hasClass('cart-closed')){this.toggleCart(undefined,animated);}};CartController.prototype.toggleCart=function(e,animated){if(typeof e!=='undefined'){e.preventDefault();animated=true;$('body').addClass('cart-toggled');}
if(typeof animated==='undefined')
animated=false;if(animated){$('body').addClass('cart-animate');setTimeout(function(){$('body').removeClass('cart-animate');$('body').trigger('cart-toggled');},500);}
$('body').toggleClass('cart-open cart-closed');if($('body').hasClass('cart-open')){$.post(this.options.cartToggleUrl+'?open');}
else{$.post(this.options.cartToggleUrl+'?close');}};CartController.prototype.updateCartVisibility=function(){var narrowWindow=$(window).width()<this.options.narrowWindowWidth;var cartVisible=$('body').hasClass('cart-open');var cartToggled=$('body').hasClass('cart-toggled');if(narrowWindow&&cartVisible){this.toggleCart();}
else if(!narrowWindow&&!cartVisible&&cartToggled){this.toggleCart();}};CartController.prototype.refreshHeader=function(){var headerCartCount=$('body').find('.top-menu .cart-count');var counterValue=this.options.el.find('.cart-count').text();if(counterValue===''){counterValue='&nbsp;';}
headerCartCount.html(counterValue);};CartController.prototype.updateAddToCartGroups=function(e,listItems,listId){if(listId!=='cart'){return;}
$.each(listItems,function(i,listItem){$('.add-to-cart-group[data-product='+listItem.product+']').each(function(i,el){el=$(el);var cartQuantity=parseInt(el.attr('data-cart-quantity'),10);if(isNaN(cartQuantity)){cartQuantity=listItem.quantity;}
else{cartQuantity+=listItem.quantity;}
setCartQuantityForEl(cartQuantity,el,{loading:true});});});};CartController.prototype.resetAddToCartGroups=function(e,productQuantities){$.each(productQuantities,function(productId,cartQuantity){$('.add-to-cart-group[data-product='+productId+']').each(function(i,el){el=$(el);setCartQuantityForEl(cartQuantity,el,{loading:false});});});};CartController.prototype.updateCheckoutProduct=function(e,productQuantities){var $checkoutProductsEl=$('#cart-checkout-products');if($checkoutProductsEl.length>0){$.get(this.options.checkoutProductsUrl,function(html){$checkoutProductsEl.html(html);});}};function setCartQuantityForEl(cartQuantity,$el,opts){opts=$.extend({loading:false},opts);var $quantityEl=$el.find('.cart-quantity');if(cartQuantity<1){$el.removeAttr('data-cart-quantity');}
else{$el.attr('data-cart-quantity',cartQuantity);}
$quantityEl.text(cartQuantity);if(opts.loading){$quantityEl.addClass('loading');}else{$quantityEl.removeClass('loading');}}
return CartController;})();var DeliveryPreselector=(function(){function DeliveryPreselector(opts){this.options={'el':null,'url':null};if(typeof opts!=='undefined'&&opts!==null){this.options=$.extend(this.options,opts);}
this.configure=__bind(this.configure,this);this.popoverShown=__bind(this.popoverShown,this);this.popoverHidden=__bind(this.popoverHidden,this);this.closePopover=__bind(this.closePopover,this);this.updateSelectedSlot=__bind(this.updateSelectedSlot,this);this.popoverVisible=false;this.configure();}
DeliveryPreselector.prototype.configure=function(){var popoverHtml='<div class="popover delivery-preselector"><div class="arrow"></div>'+'<div class="popover-inner"><div class="popover-content"><p></p></div></div></div>';var popoverBodyHtml='<div class="iframe-container"><iframe src="'+this.options.url+'" class="checkout-modal"></iframe></div>';this.options.el.click(function(e){e.preventDefault();});this.options.el.popover({html:true,container:'body',placement:'bottom',viewport:'body',template:popoverHtml,content:popoverBodyHtml});$('body').on('shown.bs.popover',this.popoverShown);$('body').on('hidden.bs.popover',this.popoverHidden);$(window).resize(this.closePopover);};DeliveryPreselector.prototype.popoverShown=function(e){if(!$(e.target).is(this.options.el)){return;}
this.popoverVisible=true;$('body').on('click',this.closePopover);};DeliveryPreselector.prototype.popoverHidden=function(e){if(!$(e.target).is(this.options.el)){return;}
this.popoverVisible=false;$('body').off('click',this.closePopover);};DeliveryPreselector.prototype.closePopover=function(){if(this.popoverVisible){this.popoverVisible=false;this.options.el.popover('hide');}};DeliveryPreselector.prototype.updateSelectedSlot=function(html){this.options.el.html(html);};return DeliveryPreselector;})();var CouponController=(function(){function CouponController(opts){this.options={'el':null,'url':null};if(typeof opts!=="undefined"&&opts!==null){this.options=$.extend(this.options,opts);}
this.configure=__bind(this.configure,this);this.showField=__bind(this.showField,this);this.submitCode=__bind(this.submitCode,this);this.linkEl=this.options.el.find('[data-action=show-coupon-field]');this.formEl=this.options.el.find('form');this.codeFieldEl=this.formEl.find('input');this.validCodeEl=this.options.el.find('.valid-coupon');this.invalidCodeEl=this.options.el.find('.invalid-coupon');this.configure();}
CouponController.prototype.configure=function(){var _this=this;this.linkEl.click(this.showField);this.formEl.find('[type=submit]').click(this.submitCode);this.codeFieldEl.on('keypress',function(){_this.invalidCodeEl.fadeOut('fast');});};CouponController.prototype.showField=function(e){var _this=this;e.preventDefault();this.linkEl.fadeOut('fast',function(){_this.formEl.fadeIn('fast',function(){_this.codeFieldEl.focus();});});};CouponController.prototype.submitCode=function(e){var _this=this;e.preventDefault();var couponCode=this.codeFieldEl.val();var submission=$.ajax({url:this.options.url,method:'POST',type:'json',data:{'coupon_code':couponCode},success:function(data){if(data.valid){_this.validCodeEl.fadeIn('fast');setTimeout(function(){window.location.href=window.location.href;},500);}
else{_this.invalidCodeEl.text(data.message);_this.invalidCodeEl.fadeIn('fast');}},error:function(){alert('An error occured.');}});};return CouponController;})();var ShowMoreController=(function(){function ShowMoreController(opts){this.options={'el':null,'url':null,'num':null,'maxNumberOfLoads':6};if(typeof opts!=="undefined"&&opts!==null){this.options=$.extend(this.options,opts);}
this.configure=__bind(this.configure,this);this.showMore=__bind(this.showMore,this);this.removeShowMore=__bind(this.removeShowMore,this);this.configure();}
ShowMoreController.prototype.configure=function(){var _this=this;var showMoreButtton=this.options.el.find('[data-action="show-more"]');this.offset=this.options.el.find('.row > div').length;showMoreButtton.on('click',this.showMore);if(this.offset<13){this.removeShowMore(showMoreButtton);}};ShowMoreController.prototype.showMore=function(e){var _this=this;var btn=$(e.target);btn.button('loading');var url=this.options.url+'?offset='+this.offset+'&num='+this.options.num;$.get(url,function(data){var newItems=$(data).hide();_this.options.el.find('.row').append(newItems);newItems.slideDown();_this.offset+=_this.options.num;btn.button('reset');if(!$.trim(data)||_this.offset>=_this.options.num*_this.options.maxNumberOfLoads){_this.removeShowMore($(e.target));}});};ShowMoreController.prototype.removeShowMore=function(btn){btn.remove();this.options.el.find('.list').removeClass('with-overlay');};return ShowMoreController;})();var InlineDeliveryLookupController=(function(){function InlineDeliveryLookupController(opts){this.configure=__bind(this.configure,this);this.configure();};InlineDeliveryLookupController.prototype.configure=function(){$(document).on('submit','[data-action=inline-delivery-lookup]',function(e){e.preventDefault();var $form=$(e.currentTarget);$.get($form.attr('action'),{zip_code:$('#id_zip_code').val()},function(html){$form.replaceWith(html);});});};return InlineDeliveryLookupController;})();var ProductListController=(function(){function ProductListController(opts){this.options={'urlAddCartProducts':'','urlAddListProducts':'','urlListProductLists':'','urlCreateProductList':'','urlViewProductList':'','urlPartialCart':'','urlPartialList':''};if(typeof opts!=="undefined"&&opts!==null){this.options=$.extend(this.options,opts);}
this.configure=__bind(this.configure,this);this.getItems=__bind(this.getItems,this);this.addItems=__bind(this.addItems,this);this.quantityAdjusted=__bind(this.quantityAdjusted,this);this.replaceProduct=__bind(this.replaceProduct,this);this.replaceAlternativeProduct=__bind(this.replaceAlternativeProduct,this);this.refreshList=__bind(this.refreshList,this);this.updateListElements=__bind(this.updateListElements,this);this.addToListClicked=__bind(this.addToListClicked,this);this.addToListPopoverClicked=__bind(this.addToListPopoverClicked,this);this.popoverShown=__bind(this.popoverShown,this);this.popoverHidden=__bind(this.popoverHidden,this);this.submitPopover=__bind(this.submitPopover,this);this.updateProductListListRow=__bind(this.updateProductListListRow,this);this.pendingUpdateTimer=null;this.pendingUpdateItems=[];this.popoverAddToList=$('body').find('.popover-add-to-list');this.popoverButtonEl=null;this.popoverButtonSelector='[data-action=add-to-list]:not([data-to-list])';this.configure();}
ProductListController.prototype.configure=function(){var _this=this;$('body').on('click','[data-action=add-to-cart]',this.addToListClicked);$('body').on('click','[data-action=add-to-list][data-to-list]',this.addToListClicked);$('body').on('click',this.popoverButtonSelector,this.addToListPopoverClicked);$('body').on('click','.product-items [data-action=adjust-quantity]',this.quantityAdjusted);$('body').on('click','.product-items [data-action=replace-product]',this.replaceProduct);$('body').on('click','[data-action=replace-alternative-product]',this.replaceAlternativeProduct);$('body').on('change','.product-items [data-action=set-quantity]',this.quantityAdjusted);$('body').on('click','.product-items [data-action=set-quantity]',function(e){this.select();});var html=this.popoverAddToList.html();$('body').popover({html:true,content:html,container:'body',placement:'bottom',selector:this.popoverButtonSelector});$('body').on('shown.bs.popover',this.popoverButtonSelector,this.popoverShown);$('body').on('hidden.bs.popover',this.popoverButtonSelector,this.popoverHidden);$('body').on('click',this.popoverButtonSelector,function(e){$(_this.popoverButtonSelector).not(this).popover('destroy');});$('body').on('click',function(e){if(_this.popoverButtonEl===null){return;}
var target=$(e.target);if(target.is(_this.popoverButtonSelector)|| target.parents(_this.popoverButtonSelector).length>0){return;}
if(target.parents('.popover.in').length>0){return;}
_this.popoverButtonEl.popover('destroy');_this.popoverButtonEl=null;$('body > .popover').remove();});$(document).on('productList:didUpdate',this.updateProductListListRow);};ProductListController.prototype.getItems=function(buttonEl,itemEls){var items=[];var toListId=buttonEl.attr('data-to-list');if(toListId===undefined){toListId=itemEls.find('[name=to_list]').val();}
var fromListId=buttonEl.attr('data-from-productlist');if(fromListId===undefined){fromListId=itemEls.find('[name=from_productlist]').val();}
var fromRecipeId=buttonEl.attr('data-from-recipe');if(fromRecipeId===undefined){fromRecipeId=itemEls.find('[name=from_recipe]').val();}
var fromRecipePortions=buttonEl.attr('data-from-recipe-portions');if(fromRecipePortions===undefined){fromRecipePortions=itemEls.find('[name=from_recipe_portions]').val();}
var buttonQuantity=parseInt(buttonEl.attr('data-quantity'),10);if(!isNaN(buttonQuantity)){var buttonProductId=buttonEl.attr('data-product');var buttonProductListId=buttonEl.attr('data-product-list');var buttonOrderNumber=buttonEl.attr('data-order');var buttonRecipeId=buttonEl.attr('data-recipe');items.push({'product':buttonProductId,'product_list':buttonProductListId,'order':buttonOrderNumber,'recipe':buttonRecipeId,'quantity':buttonQuantity,'from_list':fromListId,'from_recipe':fromRecipeId,'from_recipe_portions':fromRecipePortions});}
$.each(itemEls,function(i,item){item=$(item);var quantity=item.attr('data-quantity');if(quantity===undefined){quantity=item.find('[name=quantity]').val();}
if(isNaN(quantity)){quantity=0;}
else{quantity=parseFloat(quantity,10);}
var fromRecipeQuantityUsed=quantity;if(item.attr('data-excluded')==='excluded'){quantity=0;}
var productId=item.attr('data-product');if(typeof productId==='undefined'){productId=item.find('[name=product]').val();}
var productListId=item.attr('data-product-list');if(typeof productListId==='undefined'){productListId=item.find('[name=product_list]').val();}
var orderNumber=item.attr('data-order');if(typeof orderNumber==='undefined'){orderNumber=item.find('[name=order]').val();}
var recipeNumPortions=item.attr('data-recipe-num-portions');if(typeof recipeNumPortions==='undefined'){recipeNumPortions=item.find('[name=data-recipe-num-portions]').val();}
if(item.attr('data-from-productlist')){fromListId=item.attr('data-from-productlist');}
if(item.attr('data-from-recipe')){fromRecipeId=item.attr('data-from-recipe');}
if(item.attr('data-from-recipe-portions')){fromRecipePortions=item.attr('data-from-recipe-portions');}
if(!productId&&!productListId){return true;}
items.push({'product':productId,'product_list':productListId,'order':orderNumber,'quantity':quantity,'from_list':fromListId,'from_recipe':fromRecipeId,'from_recipe_portions':fromRecipePortions,'from_recipe_quantity_used':fromRecipeQuantityUsed});});return items;};ProductListController.prototype.addItems=function(items,toListId){var _this=this;var promise=$.Deferred();var url=this.options.urlAddListProducts.replace('0',toListId);if(toListId==='cart'){url=this.options.urlAddCartProducts;}
$(document).trigger('productList:willUpdate',[items,toListId]);this.pendingUpdateItems=this.pendingUpdateItems.concat(items);if(this.pendingUpdatePostTimer!==null){clearTimeout(this.pendingUpdatePostTimer);}
this.pendingUpdatePostTimer=setTimeout(function(){$.ajax({url:url,method:'POST',data:JSON.stringify(_this.pendingUpdateItems),contentType:'application/json; charset=UTF-8',beforeSend:function(){_this.pendingUpdateItems=[];},success:function(data){promise.resolve();if(data.success===true){if(window.cartController){if(typeof data.product_list_url==='undefined'){if($('#checkout-summary').length===0){window.cartController.showCart();}}}
$(document).trigger('productList:didUpdate',[data.product_quantities,toListId]);if(window.consumerAppController){consumerAppController.postMessage('update-cart');}}},error:function(){promise.reject();},complete:function(){_this.refreshList(toListId,items);}});},600);return promise;};ProductListController.prototype.quantityAdjusted=function(e){e.preventDefault();var _this=this;var $target=$(e.currentTarget);var queuedAnimations=$.Deferred();var item=$(e.currentTarget).closest('.product');var listEl=item.closest('.product-items');var toListId=listEl.attr('data-list');var productId=item.attr('data-product');var productListId=item.attr('data-productlist');var fromListId=item.attr('data-from-productlist');var fromRecipeId=item.attr('data-from-recipe');var quantity=parseInt(item.attr('data-quantity'),10);var deleteItem=$target.attr('data-delete')==='1';var targetQuantity=0;var deltaQuantity=0;if($target.is('input')){targetQuantity=parseInt($target.val(),10);if(isNaN(targetQuantity)){$target.val(quantity);return;}
deltaQuantity=targetQuantity-quantity;}
else{deltaQuantity=parseInt($(e.currentTarget).attr('data-quantity'),10);if(isNaN(deltaQuantity)){deltaQuantity=0;}
targetQuantity=quantity+deltaQuantity;}
if(targetQuantity>999){deltaQuantity=999-quantity;}
var data=[{'product':productId,'product_list':productListId,'quantity':deltaQuantity,'from_list':fromListId,'from_recipe':fromRecipeId,'delete':deleteItem}];var deleteQuantityLimit=1;if(toListId!=='cart'){deleteQuantityLimit=0;}
if(targetQuantity<deleteQuantityLimit||deleteItem){item.fadeOut('fast',queuedAnimations.resolve);if(item.prev(':not(.product)').length>0&&item.next(':not(.product)').length>0){item.prev('.group').fadeOut('fast');}}
else{item.find('input[data-action=set-quantity]').val(targetQuantity);item.attr('data-quantity',targetQuantity);if($target.is('input')){$target.blur();}
queuedAnimations.resolve();}
this.addItems(data,toListId);};ProductListController.prototype.replaceProduct=function(e){e.preventDefault();var _this=this;var $target=$(e.currentTarget);var item=$(e.currentTarget).closest('.product');var listEl=item.closest('.product-items');var toListId=listEl.attr('data-list');var productId=item.attr('data-product');var fromListId=item.attr('data-from-productlist');var fromRecipeId=item.attr('data-from-recipe');var newProductId=$target.attr('data-product');var quantity=parseInt(item.attr('data-quantity'),10);var data=[{'product':productId,'quantity':quantity*-1,'from_list':fromListId,'from_recipe':fromRecipeId,'delete':true},{'product':newProductId,'quantity':quantity,'from_list':fromListId,'from_recipe':fromRecipeId}];this.addItems(data,toListId);};ProductListController.prototype.replaceAlternativeProduct=function(e){e.preventDefault();var $target=$(e.currentTarget);var origProductId=$target.data('replace');var origQuantity=parseInt($target.data('quantity'),10);var fromRecipeId=$target.data('recipe');var newProductId=$target.data('product');var data=[{'product':origProductId,'quantity':origQuantity*-1,'from_recipe':fromRecipeId,'delete':true},{'product':newProductId,'quantity':origQuantity,'from_recipe':fromRecipeId,}];this.addItems(data,$target.data('to-list'));$('#modal-container').modal('hide');if(window.ga){ga('send','event','Button','Unavailable product replaced',[origProductId,newProductId,origQuantity].join(","));}}
ProductListController.prototype.refreshList=function(listId,updatedItems){var _this=this;var url=this.options.urlPartialList.replace('0',listId);if(listId==='cart'){url=this.options.urlPartialCart;}
var groupedListElements=$('.product-items[data-list='+listId+'][data-list-mode=grouped]');var aggregateListElements=$('.product-items[data-list='+listId+'][data-list-mode=aggregate]');if(groupedListElements.length>0){$.ajax({url:url+'?grouped',cache:false,success:function(data){_this.updateListElements(listId,groupedListElements,data,updatedItems);}});}
if(aggregateListElements.length>0){$.ajax({url:url+'?aggregate',cache:false,success:function(data){_this.updateListElements(listId,aggregateListElements,data,updatedItems);}});}};ProductListController.prototype.updateListElements=function(listId,listElements,html,updatedItems){var _this=this;$.each(listElements,function(i,listElement){listElement=$(listElement);var scroller=listElement.closest('.product-list-scroller');var inScroller=scroller.length>0;var scrollPos;if(inScroller){scrollPos=scroller.scrollTop();}
if(listElement.closest('#cart-sidebar').length>0){var cartSideBar=listElement.closest('#cart-sidebar');listElement.closest('#cart-sidebar').html(html);listElement=cartSideBar.find('.product-items');window.cartController.refreshHeader();}
else{if(listId==='cart'){listElement.html($(html).find('.product-items').html());}
else{listElement.html(html);}}
if(inScroller){scroller=listElement.closest('.product-list-scroller');scroller.scrollTop(scrollPos);}
if(updatedItems){_this.highlightItems(listElement,updatedItems);}});};ProductListController.prototype.highlightItems=function(listElement,withItems){function isScrolledIntoView(elem,container){var containerTop=container.offset().top;var containerBottom=containerTop+container.height();var elemTop=$(elem).offset().top;var elemBottom=elemTop+$(elem).height();return((elemBottom>=containerTop)&&(elemTop<=containerBottom)&&(elemBottom<=containerBottom)&&(elemTop>=containerTop));}
var _this=this;var firstItem=null;var itemsReady=$.Deferred();var scroller=listElement.closest('.product-list-scroller');var inScroller=scroller.length>0;$.each(withItems,function(i,el){if(el.quantity==='0'||el.quantity===0){return true;}
var ell=listElement.find('tr');if(typeof el.product!=='undefined'){ell=ell.filter('[data-product='+el.product+']');}
if(typeof el.from_recipe!=='undefined'&&el.from_recipe!==''){ell=ell.filter('[data-from-recipe='+el.from_recipe+']');}
else if(typeof el.from_list!=='undefined'){ell=ell.filter('[data-from-productlist='+el.from_list+']');}
else if(typeof el.product_list!=='undefined'){ell=ell.filter('[data-from-productlist='+el.product_list+']');}
else{ell=ell.filter('[data-from-none]');}
if(firstItem===null&&ell.length>0){firstItem=ell.first();}
itemsReady.done(function(){ell.addClass('fresh');setTimeout(function(){ell.removeClass('fresh');},500);});});if(firstItem!==null){var scrollTarget;if(inScroller&&!isScrolledIntoView(firstItem,scroller)){scrollTarget=firstItem.position().top-40;if(scrollTarget<0){scrollTarget=0;}
scroller.animate({scrollTop:scrollTarget},450,'easeInOutQuart',itemsReady.resolve);}
else{itemsReady.resolve();}}};ProductListController.prototype.addToListClicked=function(e){var _this=this;if(typeof e!=='undefined'){e.preventDefault();}
var el=$(e.currentTarget);var isButton=el.is('.btn')&&el.closest('.add-to-cart-group').length===0;var widget=el.closest('.product-list-widget');var widgetItems=widget.find('[data-product]');var loadingHtml='<span class="btn-loading"></span>';if(isButton){el.data('originalWidth',el.css('width'));el.css('width',el.outerWidth());el.css('height',el.outerHeight());if(!el.data('originalHtml')){el.data('originalHtml',el.html());}
el.html(loadingHtml);}
var toListId=el.attr('data-to-list');if(toListId===undefined){toListId=widget.find('[name=to_list]').val();}
var items=this.getItems(el,widgetItems);this.addItems(items,toListId).done(function(items){el.trigger('add-to-cart-done');if(isButton){el.html(el.data('originalHtml'));el.css('width',el.data('originalWidth'));el.removeData('originalWidth');el.removeData('originalHtml');}});var products=items.map(function(item){if(typeof item.product!=='undefined'){return item.product;}});if(products.length===1){fbq('track','AddToCart',{value:0,currency:'NOK',content_type:'product',content_ids:products});}else{fbq('track','AddToCart',{value:0,currency:'NOK',content_type:'product_group',content_ids:null});}
if(window.ga){$(items).each(function(i,item){if(typeof item.product!=='undefined'){ga('ec:addProduct',{'id':'product-'+item.product,'dimension1':'product','quantity':item.quantity});}else if(typeof item.from_recipe!=='undefined'){ga('ec:addProduct',{'id':'recipe-'+item.recipe,'dimension1':'recipe','quantity':item.quantity});}
ga('ec:setAction','add');ga('send','event','Button','Add to cart',el.attr('data-button-name'));});}};ProductListController.prototype.addToListPopoverClicked=function(e){this.popoverButtonEl=$(e.currentTarget);this.popoverItemEls=this.popoverButtonEl.closest('.product-list-widget').find('[data-product]');};ProductListController.prototype.popoverShown=function(e){var $el=$(e.target);var popover=$('body').find('.popover.in');var newFields=popover.find('.new');var existingFields=popover.find('.existing');var nameInput=popover.find('input.list-name');var selectList=popover.find('select.product-list');var submitButton=popover.find('button[name=add]');var toggleLink=popover.find('a.toggle');var selectRadioTemplate=$('<option value="{{ id }}">{{ title }}</option>');$el.closest('.buttons').addClass('popover-open');submitButton.click(this.submitPopover);toggleLink.click(function(e){e.preventDefault();newFields.toggle();existingFields.toggle();if(newFields.is(':visible')){newFields.find('input').focus();}});$.getJSON(this.options.urlListProductLists,function(data){selectList.html('');if(data.length===0){newFields.show();existingFields.hide();toggleLink.parent().hide();nameInput.focus();}
else{$.each(data,function(i,el){var selectRadioHtmlEl=selectRadioTemplate.val(el.id).text(el.title);selectList.append(selectRadioHtmlEl[0].outerHTML);});}});};ProductListController.prototype.popoverHidden=function(e){var el=$(e.currentTarget);el.closest('.buttons').removeClass('popover-open');};ProductListController.prototype.submitPopover=function(e){var _this=this;var submitButton=$(e.currentTarget);var popover=submitButton.closest('.popover');var nameInput=popover.find('input.list-name');var selectList=popover.find('select.product-list');var productListId;var productListReady=$.Deferred();var shouldCreateList=popover.find('.new').is(':visible');if(!shouldCreateList){productListId=selectList.val();productListReady.resolve();}
else{$.ajax({method:'POST',url:_this.options.urlCreateProductList,data:{'title':nameInput.val(),'is_recipe_list':'False'},success:function(data){productListId=data.id;productListReady.resolve();}});}
productListReady.done(function(){var items=_this.getItems(_this.popoverButtonEl,_this.popoverItemEls);_this.addItems(items,productListId).done(function(){popover.find('.new, .existing').hide();popover.find('.done').fadeIn('fast');submitButton.hide();var listUrl=_this.options.urlViewProductList.replace('0',productListId);popover.find('.done a').attr('href',listUrl);setTimeout(function(){$(_this.popoverButtonSelector).popover('destroy');},1500);});});};ProductListController.prototype.updateProductListListRow=function(e,_,toListId){var $row=$('[data-product-list-id="'+toListId+'"]');var reloadUrl=$row.data('reload-url');if(!reloadUrl){return;}
$.ajax(reloadUrl,{success:function(data) {$row.replaceWith(data);}});};return ProductListController;})();var RecurringOrderController=(function(){function RecurringOrderController(){this.popoverOpenSelector='[data-action="open-recurring-orders"]';this.popoverContainerSelector='.popover-recurring-orders';this.popoverContainer=$(this.popoverContainerSelector);this.popoverContentSelector='.popover-recurring-orders-content';this.popoverCloseSelector=this.popoverContentSelector+' [data-action="recurring-order-delete"], '+
this.popoverContentSelector+' [data-action="recurring-order-play"]';this.pauseSelector=this.popoverContentSelector+' [data-action="recurring-order-pause"]';this.configure=__bind(this.configure,this);this.configure();}
RecurringOrderController.prototype.configure=function(){var _this=this;$(document).popover({html:true,content:_this.popoverContainer.html(),container:'body',placement:'bottom',selector:_this.popoverOpenSelector});$(document).on('click',_this.popoverOpenSelector,function(e){e.preventDefault();});$(document).on('click',_this.popoverOpenSelector,function(e){$(_this.popoverOpenSelector).not(this).popover('destroy');});$(document).on('click',function(e){var clickTarget=$(e.target);if(clickTarget.is($(_this.popoverOpenSelector))){return;}
if($(e.target).parents('.popover.in').length===0){$(_this.popoverOpenSelector).popover('destroy');}});$(document).on('show.bs.popover',_this.popoverOpenSelector,function(e){var $clickedButton=$(e.currentTarget);$.get($clickedButton.attr('href'),function(response){$(_this.popoverContentSelector).html(response);});});$(document).on('hide.bs.popover',_this.popoverOpenSelector,function(e){var $productListRow=$(e.currentTarget).parents('[data-product-list-id]');$.get($productListRow.data('reload-url'),function(response){$productListRow.replaceWith(response);});});$(document).on('change',_this.popoverContentSelector+' select',function(e){var $select=$(this);var $form=$select.parents('form');var filteredFormUrl=$form.attr('action')+'?'+$form.serialize();$.get(filteredFormUrl,function(response){$(_this.popoverContentSelector).html(response);});});$(document).on('submit',_this.popoverContentSelector+' form',function(e){e.preventDefault();var $form=$(this);$.post($form.attr('action'),$form.serialize(),function(response){var $buttons=$(_this.popoverOpenSelector);$buttons.popover('destroy');});});$(document).on('click',_this.pauseSelector,function(e){e.preventDefault();e.stopPropagation();var $link=$(e.currentTarget);$.post($link.attr('href'),function(response){$(_this.popoverContentSelector).html(response.recurring_order_html);});});$(document).on('click',_this.popoverCloseSelector,function(e){e.preventDefault();e.stopPropagation();var $link=$(e.currentTarget);$.post($link.attr('href'),function(response){var $buttons=$(_this.popoverOpenSelector);$buttons.popover('destroy');});});};return RecurringOrderController;})();var RecipeController=(function(){function RecipeController(opts){this.options={'el':null};if(typeof opts!=='undefined'&&opts!==null){this.options=$.extend(this.options,opts);}
this.configure=__bind(this.configure,this);this.addRecipe=__bind(this.addRecipe,this);this.removeRecipe=__bind(this.removeRecipe,this);this.toggleProduct=__bind(this.toggleProduct,this);this.refresh=__bind(this.refresh,this);this.refreshRecipe=__bind(this.refreshRecipe,this);this.addToCartClicked=__bind(this.addToCartClicked,this);this.changeIngredientProductClicked=__bind(this.changeIngredientProductClicked,this);this.multiplierEls=this.options.el.find('[name=portion-multiplier]');this.printLinkEl=this.options.el.find('[data-action=print-recipe]');this.recipes={};this.configure();this.multiplierEls.first().trigger('change');this.changedRecipe=false;}
RecipeController.prototype.configure=function(){var _this=this;this.multiplierEls.on('change',function(e){var numPortions=$(e.currentTarget).val();_this.multiplierEls.val(numPortions);_this.refresh();});this.options.el.find('table.product-list tr').click(this.toggleProduct);this.options.el.find('.add-to-cart').click(this.addToCartClicked);$(document).on('click','[data-action=change-ingredient-product]',this.changeIngredientProductClicked);};RecipeController.prototype.addRecipe=function(recipe){this.recipes[recipe.id]=recipe;};RecipeController.prototype.removeRecipe=function(recipe){delete this.recipes[recipe.id];};RecipeController.prototype.recipeCount=function(){return Object.keys(this.recipes).length;};RecipeController.prototype.toggleProduct=function(e){if($(e.target).is('a')||$(e.target).closest('.change-ingredient-product').length>0){return;}
var productEl=$(e.currentTarget);productEl.attr('data-excluded',function(index,attr){return attr==='excluded'?'':'excluded';});productEl.attr('data-toggled','toggled');this.changedRecipe=true;this.refresh();};RecipeController.prototype.refresh=function(e){var _this=this;this.numPortions=parseInt(this.multiplierEls.first().val(),10);$.each(this.recipes,function(i,recipe){var recipeEl=_this.options.el.andSelf().find('[data-recipe='+recipe.id+']');_this.refreshRecipe(recipeEl,recipe,_this.numPortions);});var printUrl=this.printLinkEl.attr('href');printUrl=printUrl.substring(0,printUrl.indexOf('?'));printUrl+='?portions='+this.numPortions;this.printLinkEl.attr('href',printUrl);};RecipeController.prototype.refreshRecipe=function(recipeEl,recipe,numPortions){var _this=this;var products={};var recipePrice=0;var recipePortionPrice=0;$.each(recipe.ingredients,function(i,item){var ingredientQuantity=item.ingredient.portion_quantity*numPortions;var productQuantity=item.product.portion_quantity*numPortions;if(!(item.product.id in products)){products[item.product.id]={'quantityRounded':0,'quantityUsed':0,'quantityCartUnused':0,'price':item.product.price};}
var productEntry=products[item.product.id];productEntry.quantityUsed+=productQuantity;productEntry.quantityRounded=Math.ceil(productEntry.quantityUsed);productEntry.quantityCartUnused=item.product.unused_quantity;var ingredientEl=recipeEl.find('[data-ingredient-for='+item.id+']');ingredientEl.find('[data-field=ingredient-quantity]').text(amountString(ingredientQuantity,'auto'));});$.each(products,function(id,product){var productEl=recipeEl.find('[data-product='+id+']');if(productEl.length===0){return true;}
var alreadyInCart=(product.quantityCartUnused>=product.quantityUsed&&product.quantityCartUnused>0);if(alreadyInCart&&!(productEl.attr('data-toggled')==='toggled')){productEl.attr('data-excluded','excluded');}
productEl.find('.in-cart-badge').toggle(alreadyInCart);productEl.find('[data-field=product-quantity]').text(product.quantityRounded);productEl.find('[data-field=product-price]').text(amountString(product.price*product.quantityRounded,2));var productExcluded=(productEl.attr('data-excluded')==='excluded');if(!productExcluded){recipePrice+=(product.price*product.quantityRounded);recipePortionPrice+=(product.price*product.quantityUsed);}
productEl.find('input[name=quantity]').val(product.quantityUsed);});recipeEl.find('[data-field=recipe-price]').html(priceMarkup(recipePrice));recipeEl.find('[data-field=recipe-portion-price]').html(priceMarkup(recipePortionPrice/numPortions));recipeEl.find('[data-field=recipe-portions]').text(numPortions);recipeEl.find('[data-from-recipe-portions]').attr('data-from-recipe-portions',numPortions);};RecipeController.prototype.addToCartClicked=function(e){};RecipeController.prototype.changeIngredientProductClicked=function(e){var data=$(e.currentTarget).data();var recipeEl=this.options.el.andSelf().find('[data-recipe='+data.recipe+']');var productEl=recipeEl.find('[data-ingredient-item='+data.ingredientItem+']');productEl.find('[data-field=product-image]').attr('src',data.productImage);productEl.find('[data-field=product-name]').text(data.productName);productEl.find('[data-field=product-name]').attr('href',data.productUrl);productEl.find('[data-field=product-name-extra]').text(data.productNameExtra);productEl.attr('data-product',data.product);productEl.attr('data-excluded','');var recipe=this.recipes[data.recipe];var ingredient;for(var i=0;i<recipe.ingredients.length;i++){ingredient=recipe.ingredients[i];if(ingredient.id===parseInt(data.ingredientItem,10)){break;}}
var origProductId=ingredient.product.id;ingredient.product={id:parseInt(data.product,10),portion_quantity:data.portionQuantity.replace(',','.'),price:data.productPrice.replace(',','.'),unused_quantity:data.unusedQuantity,};this.refresh();window.modalController.closeModal();if(window.ga){ga('send','event','Button','Recipe ingredient changed',[data.recipe,origProductId,ingredient.product.id].join(','));}};return RecipeController;})();var RecipeLikeController=(function(){function RecipeLikeController(opts){this.options={'elSelector':null};if(typeof opts!=='undefined'&&opts!==null){this.options=$.extend(this.options,opts);}
this.configure=__bind(this.configure,this);this.toggleLike=__bind(this.toggleLike,this);this.configure();}
RecipeLikeController.prototype.configure=function(){$(document).on('submit',this.options.elSelector+' form',this.toggleLike);};RecipeLikeController.prototype.toggleLike=function(e){var form=$(e.target);var element=form.closest(this.options.elSelector);var url=form.attr('action');var btn=form.find('button');var likeCount=form.find('.like-count');btn.attr('disabled','disabled');$.post(url,function(data){if(data.success){if(data.user_likes_recipe){element.addClass('liked');}else{element.removeClass('liked');}
likeCount.html(data.like_count);btn.removeAttr('disabled');}});e.preventDefault();};return RecipeLikeController;})();(function(){$(document).on('productList:didUpdate',function(e,productQuantities){var $container=$('.modal-body:visible [data-reload-recommended-products]');if(!$container.length){$container=$('[data-reload-recommended-products]');}
if($container.length===0){return;}
$.get($container.data('reload-recommended-products'),function(html){$container.replaceWith(html);});});})();var SearchController=(function(){function SearchController(opts){this.options={'inputEl':null,'searchUrl':null,'boostUrl':null,'toList':null,'resultClicked':null,'resultButtonClicked':null,'formSubmitted':null};if(typeof opts!=='undefined'&&opts!==null){this.options=$.extend(this.options,opts);}
this.configure=__bind(this.configure,this);this.resultButtonClicked=__bind(this.resultButtonClicked,this);this.formSubmitted=__bind(this.formSubmitted,this);this.addToCartDone=__bind(this.addToCartDone,this);this.configure();}
SearchController.prototype.configure=function(){var _this=this;var form=this.options.inputEl.closest('form');form.on('click','button',this.resultButtonClicked);form.on('submit',this.formSubmitted);$('.search-results .product-list-item button').click(this.resultButtonClicked);$(document).on('add-to-cart-done','[role=search] [data-action=add-to-cart]',this.addToCartDone);var remoteUrl=this.options.searchUrl+'?q=%QUERY';if(this.options.toList!==null){remoteUrl=remoteUrl+'&to_list='+this.options.toList;}
var engine=new Bloodhound({limit:15,remote:{url:remoteUrl,wildcard:'%QUERY',filter:function(parsedResponse){return parsedResponse.results;}},datumTokenizer:function(d){return Bloodhound.tokenizers.whitespace(d.val);},queryTokenizer:Bloodhound.tokenizers.whitespace});engine.initialize();this.options.inputEl.typeahead({highlight:true,hint:false,minLength:1},{name:'results',source:engine.ttAdapter(),limit:20,templates:{suggestion:function(context){return context.html;}}}).bind('typeahead:asyncrequest',function(e,query,dataset_name){_this.options.inputEl.closest('form').addClass('loading');}).bind('typeahead:asyncreceive',function(e,query,dataset_name){_this.options.inputEl.closest('form').removeClass('loading');}).bind('typeahead:selected',function(e,datum){if(_this.options.resultClicked!==null){_this.options.resultClicked(e,datum);return;}
if(datum.type==='product'){window.modalController.openModal({url:datum.url},true);return;}
if(datum.type==='category'){location.href=datum.url;return;}
if(datum.type==='more_results'){_this.options.inputEl.closest('form').submit();return;}}).bind('typeahead:close',function(){if(_this.didAddToCart){$('.tt-input[name=q]').val('');}
_this.didAddToCart=false;});};SearchController.prototype.resultButtonClicked=function(e){if(this.options.resultButtonClicked!==null){this.options.resultButtonClicked(e);}else{var query=this.options.inputEl.val();var productId=$(e.currentTarget).attr('data-product');if(typeof productId!=='undefined'){$.post(this.options.boostUrl,{q:query,product_id:productId});}}};SearchController.prototype.formSubmitted=function(e){if(this.options.formSubmitted!==null){this.options.formSubmitted(e);}};SearchController.prototype.addToCartDone=function(e){$('.tt-input[name=q]').val('').focus();this.didAddToCart=true;};return SearchController;})();var SearchResultPageController=(function(){function SearchResultPageController(opts){this.options={};if(typeof opts!=='undefined'&&opts!==null){this.options=$.extend(this.options,opts);}
this.configure=__bind(this.configure,this);this.updateSearchResult=__bind(this.updateSearchResult,this);this.toggleExpandedFilterOptions=__bind(this.toggleExpandedFilterOptions,this);this.toggleExpandedFilter=__bind(this.toggleExpandedFilter,this);this.toggleFilterSidebar=__bind(this.toggleFilterSidebar,this);this.configure();}
SearchResultPageController.prototype.configure=function(){$(document).on('click','[data-update-search-result]',this.updateSearchResult);$(document).on('click','.search-filter .expand-more-filter-options',this.toggleExpandedFilterOptions);$(document).on('click','.search-filter .expand-filter',this.toggleExpandedFilter);$(document).on('click','[data-toggle-filter-sidebar]',this.toggleFilterSidebar);};SearchResultPageController.prototype.updateSearchResult=function(e){if(e.ctrlKey||e.metaKey){return;}
if(!history.replaceState){return;}
e.preventDefault();var $link=$(e.currentTarget);var url=$link.attr('href');$.get(url,function(html){history.replaceState({},'Search filter',url);$('[data-search-result]').replaceWith(html);if(window.ga){ga('set','location',window.location.href);ga('set','page',window.location.pathname);ga('send','pageview',window.location.pathname+window.location.search);}});};SearchResultPageController.prototype.toggleExpandedFilterOptions=function(e){var $el=$(e.currentTarget);$el.parents('.search-filter').toggleClass('expanded').toggleClass('collapsed');};SearchResultPageController.prototype.toggleExpandedFilter=function(e){var $el=$(e.currentTarget);$el.parents('.search-filter').toggleClass('opened').toggleClass('closed');};SearchResultPageController.prototype.toggleFilterSidebar=function(e){$('.filter-sidebar').toggleClass('opened');};return SearchResultPageController;})();(function(){$(document).on('chat.enabled',function(){$('html').addClass('chat-enabled');});$(document).on('chat.open',function(){var $stateDiv=$('#habla_window_state_div');$stateDiv.addClass('animated');setTimeout(function(){$stateDiv.removeClass('animated');},500);});$(document).on('click','[data-action=open-chat]',function(e){e.preventDefault();window.olark('api.box.expand');});})();var SliderWidgetController=(function(){function SliderWidgetController(opts){if(opts.el){this.wrapper=opts.el;}else{this.wrapper=document.querySelector(opts.selector);}
this.el=this.wrapper.querySelector('input');this.nob=this.wrapper.querySelector('.slider-widget-nob');this.nobText=this.wrapper.querySelector('.slider-widget-nob-text');this.slider=this.wrapper.querySelector('.slider-widget-slider');this.sliderPoints=this.wrapper.querySelector('.slider-widget-points');this.sliderUnselectedPoints=this.wrapper.querySelector('.slider-widget-unselected-points');this.sliderFill=this.wrapper.querySelector('.slider-widget-fill');this.configure();}
SliderWidgetController.prototype.configure=function(){this.min=parseInt(this.el.getAttribute('min'),10);this.max=parseInt(this.el.getAttribute('max'),10);var width=this.slider.getBoundingClientRect().width;this.slider.setAttribute('viewBox','-15 0 '+width+' 84');this.spacing=(width-24.0-30.0)/(this.max-1);this.renderPoints(this.sliderPoints);this.renderPoints(this.sliderUnselectedPoints);this.wrapper.addEventListener('touchstart',this,false);this.wrapper.addEventListener('mousedown',this,false);this.wrapper.addEventListener('touchend',this,false);this.wrapper.addEventListener('touchcancel',this,false);this.wrapper.addEventListener('mouseup',this,false);this.el.addEventListener('change',this,false);this.el.addEventListener('input',this,false);this.el.style.opacity='0';this.el.style.position='absolute';this.el.style.top='0';this.el.style.bottom='0';this.el.style.left='0';this.el.style.right='0';this.updateSlider(parseInt(this.el.value,10)-1,true);};SliderWidgetController.prototype.renderPoints=function(parent){var i,circle,namespace='http://www.w3.org/2000/svg';for(i=0;i<this.max;i++){circle=document.createElementNS(namespace,'circle');circle.setAttribute('cx',12+this.spacing*i);circle.setAttribute('cy','12');circle.setAttribute('r','4');parent.appendChild(circle);}};SliderWidgetController.prototype.updateSlider=function(value,force){var currentValue=parseInt(this.el.value,10)-1;if(currentValue!==value||force===true){this.sliderFill.setAttribute('width',this.spacing*value+24);this.el.value=value+1;this.nobText.textContent=value+1;var nobPos=(this.spacing*value+12)-(41/2);this.nob.style.transform='translate('+nobPos+'px,2px)';this.nob.setAttribute('transform','translate('+nobPos+', 2)');}};SliderWidgetController.prototype.updateFromEvent=function(e){e.preventDefault();var rect=this.slider.getBoundingClientRect();var pageX;if(e.touches){if(e.touches.length>0){var touch=e.touches.item(0);pageX=touch.pageX;}}else{pageX=e.clientX;}
var x=pageX-rect.left-15;var value=Math.max(Math.min(Math.round((x-12)/this.spacing),this.max-1),0);if(!isNaN(value)){this.updateSlider(value);}};SliderWidgetController.prototype.handleEvent=function(e){switch(e.type){case'touchstart':this.updateFromEvent(e);this.wrapper.addEventListener('touchmove',this,false);break;case'touchend':case'touchcancel':this.updateFromEvent(e);this.wrapper.removeEventListener('touchmove',this,false);break;case'mousedown':this.updateFromEvent(e);this.wrapper.addEventListener('mousemove',this,false);break;case'mouseup':this.updateFromEvent(e);this.wrapper.removeEventListener('mousemove',this,false);break;case'mousemove':case'touchmove':this.updateFromEvent(e);break;case'change':case'input':this.updateSlider(parseInt(e.target.value,10)-1,true);break;}};return SliderWidgetController;})();$('body').on('submit','.modal .dinner-suggestions-wizard-form',function(e){var el=$(this);e.preventDefault();var url=el.attr('action');if(url.indexOf('?')>-1){url+='&modal';}else{url+='?modal';}
$.ajax({type:el.attr('method'),url:url,data:el.serialize(),success:function(data,status,response){window.modalController.slideIn(data);},error:function(data,status,response){console.log('An error occurred.');console.log(this,arguments);},});});$(window).on('load',function(){if(!window.console){return;}
var str=['','','         .::::.           .-:::- ','        -//////:-`     `-://////-','        .:////////:.`.:////////:.','         `.:////////////////::.` ','            `-:///////////:-`    ','              `.:://///::.`      ','                 `-:/:-`         ','                    ``           ','         `.....................` ','        .://///////////////////:.','        -///////////////////////:','        `-:://////////////////:-`','',''].join('\n');var linkStr=['              Interessert?','','        https://kolonial.no/tech/','',''].join('\n');console.log('%c'+str+'\n%c'+linkStr,'font-family: "Lucida Console", Monaco, monospace; color: #ffa514;','color: #8e7a98; font-family: "Lucida Console", Monaco, monospace;');});